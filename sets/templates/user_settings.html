{% extends 'settingsBase.html' %}

{% block css %}
		<style type="text/css">
			.all {
				width: 100%;
				height: 100%;
				padding-bottom: 100px;
			}
			.banner{
				float: left;
				width: 100%;
				text-align: center;
			}
			.rest{
				float: left;
				width: 100%;
			}
			table{
				border: 1px solid black;
				width: 100%;
				text-align: center;
			}
			th{
				border: 1px solid black;
				background-color: white;
			}
			tr, td{
				border: 1px solid black;
			}
			tr:nth-child(even) {
				background-color: transparent;
			}
			tr:nth-child(odd) {
				background-color: #C7E7FD;
			}
			body, html{
				background-color: #DFF2FC;
			}
			.btn{
				background-color: white;
				padding: 15px;
			}
			#user_type{
				background-color: white;
				padding: 12px;
			}
		</style>
{% endblock css %}

{% block content %}
						<div class="all">
							<div class="banner">
								{% if user.is_superuser %}
								<select name="user_type" id="user_type" style="display: inline-block; float: left;">
									<option value="admin">Admins</option>
									<option value="employee">Employees</option>
									<option value="client">Clients</option>
								</select>
								{% endif %}
								<h1 style="display: inline-block;">Manage {% if user.is_superuser %}Users{% else %}Clients{% endif %}</h1>
								{% if user.is_superuser %}
								<a href="/createuser/"><button class="btn" style="display: inline-block; float: right;">Add User</button></a>
								{% endif %}
							</div>
							<div class="rest">
								<table id="users_table">
								</table>

							</div>
						</div><br><br><br><br><br><br>
{% endblock content %}

{% block js %}
		{% if user.is_superuser %}
		<script type="text/javascript">
			let user = $('#user_type').val();

			$.ajax({
				url: '/ajax/users/',
				data: {
					'user': user
				},
				dataType: 'json',
				success: function(data){
					table_create(data);
				}
			})
			$('#user_type').change(function(){
				let user = $(this).val();

				$.ajax({
					url: '/ajax/users/',
					data: {
						'user': user
					},
					dataType: 'json',
					success: function(data){
						table_create(data);					}
				})
			})
			const table_create = (data) => {
				const table = $('#users_table');
						table.empty();
						head = "<tr><th>Lp.</th><th>Name</th><th>Surname</th><th>PESEL</th><th>City</th><th>Detail</th><th>Delete</th></tr>";
						table.append(head);
						let y = 1;
						for(let i = 0;i < data['users'].length;i++){
							user = data['users'][i]
							//console.log(user);
							row = "<tr><td>"+ y +"</td><td>"+ user['first_name'] +"</td><td>"+ user['last_name'] +"</td><td>"+ user['pesel'] +"</td><td>"+ user['city'] +"</td><td><a href='/user/"+ user['user_id'] +"/'><svg width='1em' height='1em' viewBox='0 0 16 16' class='bi bi-person' fill='currentColor'><path fill-rule='evenodd' d='M10 5a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm6 5c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z'/></svg></a></td><td><a href='/userdelete/"+ user['user_id'] +"/'><svg width='1em' height='1em' viewBox='0 0 16 16' class='bi bi-trash' fill='currentColor'><path d='M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z'/><path fill-rule='evenodd' d='M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z'/></svg></a></td></tr>";
							table.append(row);
							y += 1;
						}
			}
		</script>
		{% else %}
		<script type="text/javascript">
			$.ajax({
				url: '/ajax/users/',
				data: {
					'user': 'client'
				},
				dataType: 'json',
				success: function(data){
					table_create(data);
				}
			})
			const table_create = (data) => {
				const table = $('#users_table');
						table.empty();
						head = "<tr><th>Lp.</th><th>Name</th><th>Surname</th><th>PESEL</th><th>City</th><th>Detail</th><th>Delete</th></tr>";
						table.append(head);
						let y = 1;
						for(let i = 0;i < data['users'].length;i++){
							user = data['users'][i]
							//console.log(user);
							row = "<tr><td>"+ y +"</td><td>"+ user['first_name'] +"</td><td>"+ user['last_name'] +"</td><td>"+ user['pesel'] +"</td><td>"+ user['city'] +"</td><td><a href='/user/"+ user['user_id'] +"/'><svg width='1em' height='1em' viewBox='0 0 16 16' class='bi bi-person' fill='currentColor'><path fill-rule='evenodd' d='M10 5a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm6 5c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z'/></svg></a></td><td><a href='/userdelete/"+ user['user_id'] +"/'><svg width='1em' height='1em' viewBox='0 0 16 16' class='bi bi-trash' fill='currentColor'><path d='M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z'/><path fill-rule='evenodd' d='M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z'/></svg></a></td></tr>";
							table.append(row);
							y += 1;
						}
			}
		</script>
		{% endif %}
{% endblock js %}